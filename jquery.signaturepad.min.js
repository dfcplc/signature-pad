!function(t){function e(e,n){function a(){clearTimeout(M),M=!1,O=!1}function r(e,n){var a,r,i;return e.preventDefault(),a=t(e.target).offset(),clearTimeout(M),M=!1,"undefined"!=typeof e.targetTouches?(r=Math.floor(e.targetTouches[0].pageX-a.left),i=Math.floor(e.targetTouches[0].pageY-a.top)):(r=Math.floor(e.pageX-a.left),i=Math.floor(e.pageY-a.top)),T.x===r&&T.y===i?!0:(null===T.x&&(T.x=r),null===T.y&&(T.y=i),n&&(i+=n),E.beginPath(),E.moveTo(T.x,T.y),E.lineTo(r,i),E.lineCap=x.penCap,E.stroke(),E.closePath(),k.push({lx:r,ly:i,mx:T.x,my:T.y}),T.x=r,T.y=i,void(x.onDraw&&"function"==typeof x.onDraw&&x.onDraw.apply(b)))}function i(){o()}function o(e){e?r(e,1):(P?D.each(function(){this.removeEventListener("touchmove",r)}):D.unbind("mousemove.signaturepad"),k.length>0&&x.onDrawEnd&&"function"==typeof x.onDrawEnd&&x.onDrawEnd.apply(b)),T.x=null,T.y=null,x.output&&k.length>0&&t(x.output,I).val(JSON.stringify(k))}function u(){return x.lineWidth?(E.beginPath(),E.lineWidth=x.lineWidth,E.strokeStyle=x.lineColour,E.moveTo(x.lineMargin,x.lineTop),E.lineTo(S.width-x.lineMargin,x.lineTop),E.stroke(),void E.closePath()):!1}function l(){E.clearRect(0,0,S.width,S.height),E.fillStyle=x.bgColour,E.fillRect(0,0,S.width,S.height),x.displayOnly||u(),E.lineWidth=x.penWidth,E.strokeStyle=x.penColour,t(x.output,I).val(""),k=[],o()}function s(t,e){null==T.x?r(t,1):r(t,e)}function d(t,e){P?e.addEventListener("touchmove",s,!1):D.bind("mousemove.signaturepad",s),r(t,1)}function c(){W=!1,D.each(function(){this.removeEventListener&&(this.removeEventListener("touchend",i),this.removeEventListener("touchcancel",i),this.removeEventListener("touchmove",r)),this.ontouchstart&&(this.ontouchstart=null)}),t(document).unbind("mouseup.signaturepad"),D.unbind("mousedown.signaturepad"),D.unbind("mousemove.signaturepad"),D.unbind("mouseleave.signaturepad"),t(x.clear,I).unbind("click.signaturepad")}function p(e){return W?!1:(W=!0,t("input").blur(),"undefined"!=typeof e.targetTouches&&(P=!0),void(P?(D.each(function(){this.addEventListener("touchend",i,!1),this.addEventListener("touchcancel",i,!1)}),D.unbind("mousedown.signaturepad")):(t(document).bind("mouseup.signaturepad",function(){O&&(o(),a())}),D.bind("mouseleave.signaturepad",function(t){O&&o(t),O&&!M&&(M=setTimeout(function(){o(),a()},500))}),D.each(function(){this.ontouchstart=null}))))}function f(){t(x.typed,I).hide(),l(),D.each(function(){this.ontouchstart=function(t){t.preventDefault(),O=!0,p(t),d(t,this)}}),D.bind("mousedown.signaturepad",function(t){return t.preventDefault(),t.which>1?!1:(O=!0,p(t),void d(t))}),t(x.clear,I).bind("click.signaturepad",function(t){t.preventDefault(),l()}),t(x.typeIt,I).bind("click.signaturepad",function(t){t.preventDefault(),h()}),t(x.drawIt,I).unbind("click.signaturepad"),t(x.drawIt,I).bind("click.signaturepad",function(t){t.preventDefault()}),t(x.typeIt,I).removeClass(x.currentClass),t(x.drawIt,I).addClass(x.currentClass),t(x.sig,I).addClass(x.currentClass),t(x.typeItDesc,I).hide(),t(x.drawItDesc,I).show(),t(x.clear,I).show()}function h(){l(),c(),t(x.typed,I).show(),t(x.drawIt,I).bind("click.signaturepad",function(t){t.preventDefault(),f()}),t(x.typeIt,I).unbind("click.signaturepad"),t(x.typeIt,I).bind("click.signaturepad",function(t){t.preventDefault()}),t(x.output,I).val(""),t(x.drawIt,I).removeClass(x.currentClass),t(x.typeIt,I).addClass(x.currentClass),t(x.sig,I).removeClass(x.currentClass),t(x.drawItDesc,I).hide(),t(x.clear,I).hide(),t(x.typeItDesc,I).show(),L=F=t(x.typed,I).css("font-size").replace(/px/,"")}function g(e){var n=t(x.typed,I),a=t.trim(e.replace(/>/g,"&gt;").replace(/</g,"&lt;")),r=J,i=.5*L;if(J=a.length,n.html(a),!a)return void n.css("font-size",F+"px");if(J>r&&n.outerWidth()>S.width)for(;n.outerWidth()>S.width;)L--,n.css("font-size",L+"px");if(r>J&&n.outerWidth()+i<S.width&&F>L)for(;n.outerWidth()+i<S.width&&F>L;)L++,n.css("font-size",L+"px")}function v(e,n){t("p."+n.errorClass,e).remove(),e.removeClass(n.errorClass),t("input, label",e).removeClass(n.errorClass)}function m(e,n,a){e.nameInvalid&&(n.prepend(['<p class="',a.errorClass,'">',a.errorMessage,"</p>"].join("")),t(a.name,n).focus(),t(a.name,n).addClass(a.errorClass),t("label[for="+t(a.name).attr("id")+"]",n).addClass(a.errorClass)),e.drawInvalid&&n.prepend(['<p class="',a.errorClass,'">',a.errorMessageDraw,"</p>"].join(""))}function y(){var e=!0,n={drawInvalid:!1,nameInvalid:!1},a=[I,x],r=[n,I,x];return x.onBeforeValidate&&"function"==typeof x.onBeforeValidate?x.onBeforeValidate.apply(b,a):v.apply(b,a),x.drawOnly&&k.length<1&&(n.drawInvalid=!0,e=!1),""===t(x.name,I).val()&&(n.nameInvalid=!0,e=!1),x.onFormError&&"function"==typeof x.onFormError?x.onFormError.apply(b,r):m.apply(b,r),e}function w(t,e,n){for(var a in t)"object"==typeof t[a]&&(e.beginPath(),e.moveTo(t[a].mx,t[a].my),e.lineTo(t[a].lx,t[a].ly),e.lineCap=x.penCap,e.stroke(),e.closePath(),n&&k.push({lx:t[a].lx,ly:t[a].ly,mx:t[a].mx,my:t[a].my}))}function C(){parseFloat((/CPU.+OS ([0-9_]{3}).*AppleWebkit.*Mobile/i.exec(navigator.userAgent)||[0,"4_2"])[1].replace("_","."))<4.1&&(t.fn.Oldoffset=t.fn.offset,t.fn.offset=function(){var e=t(this).Oldoffset();return e.top-=window.scrollY,e.left-=window.scrollX,e}),t(x.typed,I).bind("selectstart.signaturepad",function(e){return t(e.target).is(":input")}),D.bind("selectstart.signaturepad",function(e){return t(e.target).is(":input")}),!S.getContext&&FlashCanvas&&FlashCanvas.initElement(S),S.getContext&&(E=S.getContext("2d"),t(x.sig,I).show(),x.displayOnly||(x.drawOnly||(t(x.name,I).bind("keyup.signaturepad",function(){g(t(this).val())}),t(x.name,I).bind("blur.signaturepad",function(){g(t(this).val())}),t(x.drawIt,I).bind("click.signaturepad",function(t){t.preventDefault(),f()})),x.drawOnly||"drawIt"===x.defaultAction?f():h(),x.validateFields&&(t(e).is("form")?t(e).bind("submit.signaturepad",function(){return y()}):t(e).parents("form").bind("submit.signaturepad",function(){return y()})),t(x.sigNav,I).show()))}var b=this,x=t.extend({},t.fn.signaturePad.defaults,n),I=t(e),D=t(x.canvas,I),S=D.get(0),E=null,T={x:null,y:null},k=[],M=!1,O=!1,P=!1,W=!1,F=30,L=F,J=0;t.extend(b,{signaturePad:"{{version}}",init:function(){C()},updateOptions:function(e){t.extend(x,e)},regenerate:function(e){b.clearCanvas(),t(x.typed,I).hide(),"string"==typeof e&&(e=JSON.parse(e)),w(e,E,!0),x.output&&t(x.output,I).length>0&&t(x.output,I).val(JSON.stringify(k))},clearCanvas:function(){l()},getSignature:function(){return k},getSignatureString:function(){return JSON.stringify(k)},getSignatureImage:function(){var t=document.createElement("canvas"),e=null,n=null;return t.style.position="absolute",t.style.top="-999em",t.width=S.width,t.height=S.height,document.body.appendChild(t),!t.getContext&&FlashCanvas&&FlashCanvas.initElement(t),e=t.getContext("2d"),e.fillStyle=x.bgColour,e.fillRect(0,0,S.width,S.height),e.lineWidth=x.penWidth,e.strokeStyle=x.penColour,w(k,e),n=t.toDataURL.apply(t,arguments),document.body.removeChild(t),t=null,n},validateForm:function(){return y()},inflateToJsonSignature:function(t,e){var n,a,r,i,o,u,l=[],s=1,d=/^(?:\[(\d+)x(\d+)\])?([\w\W]*)/,c=t.match(d);for(c&&e&&(n=e.x/(c[1]||1),a=e.y/(c[2]||1),s=a>n?n:a,t=c[3]),o=t.length,r=0;r<t.length;r++)l.push(t[r].charCodeAt().toString());for(u=l.length,i="[",r=0;u>r;r+=4)i+='{"lx":'+Math.round(l[r]*s)+',"ly":'+Math.round(l[r+1]*s)+',"mx":'+Math.round(l[r+2]*s)+',"my":'+Math.round(l[r+3]*s)+"},";return i.substring(0,i.length-1)+"]"},deflateFromJsonSignature:function(t,e){var n,a,r,i="";for(n=t.substring(2,t.length-2).replace(/"[lm][xy]":/g,"").replace(/},{/g,",").split(","),a=n.length,r=0;a>r;r+=1)n[r]=n[r]<0?0:n[r],i+=String.fromCharCode(parseInt(n[r].toString()));return e&&(i="["+e.x+"x"+e.y+"]"+i),i},callInflate:function(){var t=inflateToJsonSignature(b.getSignatureString());return t},callDeflate:function(){var t=deflateFromJsonSignature(b.getSignatureString());return t}})}t.fn.signaturePad=function(n){var a=null;return this.each(function(){t.data(this,"plugin-signaturePad")?(a=t.data(this,"plugin-signaturePad"),a.updateOptions(n)):(a=new e(this,n),a.init(),t.data(this,"plugin-signaturePad",a))}),a},t.fn.signaturePad.defaults={defaultAction:"typeIt",displayOnly:!1,drawOnly:!1,canvas:"canvas",sig:".sig",sigNav:".sigNav",bgColour:"#ffffff",penColour:"#145394",penWidth:2,penCap:"round",lineColour:"#ccc",lineWidth:2,lineMargin:5,lineTop:35,name:".name",typed:".typed",clear:".clearButton",typeIt:".typeIt a",drawIt:".drawIt a",typeItDesc:".typeItDesc",drawItDesc:".drawItDesc",output:".output",currentClass:"current",validateFields:!0,errorClass:"error",errorMessage:"Please enter your name",errorMessageDraw:"Please sign the document",onBeforeValidate:null,onFormError:null,onDraw:null,onDrawEnd:null}}(jQuery);